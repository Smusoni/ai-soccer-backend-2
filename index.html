<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5, user-scalable=yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <title>Ball Knowledge</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link href="https://api.fontshare.com/v2/css?f[]=kola@400&display=swap" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
    
    :root{
      --bg:#0A0E1A;
      --bg-elevated:#0F1420;
      --card:#141B2D;
      --card-hover:#1A2338;
      --surface:#0D1219;
      --muted:#7B8BA3;
      --text:#E4E8F0;
      --text-bright:#FFFFFF;
      --line:#1E2A42;
      --line-bright:#2A3A5A;
      --accent:#00D9FF;
      --accent-hover:#33E3FF;
      --accent2:#0088FF;
      --accent-dark:#00B8DB;
      --success:#00E676;
      --warning:#FFB300;
      --error:#FF3D57;
      --gradient-primary:linear-gradient(135deg, #0088FF 0%, #00D9FF 100%);
      --gradient-card:linear-gradient(180deg, rgba(20,27,45,0.7) 0%, rgba(20,27,45,0.95) 100%);
      --shadow-sm:0 2px 4px rgba(0,0,0,0.4);
      --shadow-md:0 4px 16px rgba(0,0,0,0.5);
      --shadow-lg:0 8px 32px rgba(0,0,0,0.6);
      --shadow-glow:0 0 24px rgba(0,217,255,0.35);
    }
    
    [data-theme="light"]{
      --bg:#FFFFFF;
      --bg-elevated:#F6F8FA;
      --card:#FFFFFF;
      --card-hover:#F6F8FA;
      --surface:#FAFBFC;
      --muted:#57606A;
      --text:#1F2328;
      --text-bright:#000000;
      --line:#D0D7DE;
      --line-bright:#B0B8C0;
      --accent:#2DA44E;
      --accent-hover:#2C974B;
      --accent2:#0969DA;
      --accent-dark:#1A7F37;
      --success:#2DA44E;
      --warning:#BF8700;
      --error:#CF222E;
      --gradient-primary:linear-gradient(135deg, #2DA44E 0%, #0969DA 100%);
      --gradient-card:linear-gradient(180deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.95) 100%);
      --shadow-sm:0 1px 3px rgba(0,0,0,0.1);
      --shadow-md:0 4px 12px rgba(0,0,0,0.15);
      --shadow-lg:0 8px 24px rgba(0,0,0,0.2);
      --shadow-glow:0 0 20px rgba(45,164,78,0.2);
    }
    
    [data-theme="light"]{
      --bg:#FFFFFF;
      --bg-elevated:#F6F8FA;
      --card:#FFFFFF;
      --card-hover:#F6F8FA;
      --surface:#FAFBFC;
      --muted:#57606A;
      --text:#1F2328;
      --text-bright:#000000;
      --line:#D0D7DE;
      --line-bright:#B0B8C0;
      --accent:#2DA44E;
      --accent-hover:#2C974B;
      --accent2:#0969DA;
      --accent-dark:#1A7F37;
      --success:#2DA44E;
      --warning:#BF8700;
      --error:#CF222E;
      --gradient-primary:linear-gradient(135deg, #2DA44E 0%, #0969DA 100%);
      --gradient-card:linear-gradient(180deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.95) 100%);
      --shadow-sm:0 1px 3px rgba(0,0,0,0.1);
      --shadow-md:0 4px 12px rgba(0,0,0,0.15);
      --shadow-lg:0 8px 24px rgba(0,0,0,0.2);
      --shadow-glow:0 0 20px rgba(45,164,78,0.2);
    }
    
    [data-theme="light"]{
      --bg:#FFFFFF;
      --bg-elevated:#F6F8FA;
      --card:#FFFFFF;
      --card-hover:#F6F8FA;
      --surface:#FAFBFC;
      --muted:#57606A;
      --text:#1F2328;
      --text-bright:#000000;
      --line:#D0D7DE;
      --line-bright:#B0B8C0;
      --accent:#2DA44E;
      --accent-hover:#2C974B;
      --accent2:#0969DA;
      --accent-dark:#1A7F37;
      --success:#2DA44E;
      --warning:#BF8700;
      --error:#CF222E;
      --gradient-primary:linear-gradient(135deg, #2DA44E 0%, #0969DA 100%);
      --gradient-card:linear-gradient(180deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.95) 100%);
      --shadow-sm:0 1px 3px rgba(0,0,0,0.1);
      --shadow-md:0 4px 12px rgba(0,0,0,0.15);
      --shadow-lg:0 8px 24px rgba(0,0,0,0.2);
      --shadow-glow:0 0 20px rgba(45,164,78,0.2);
    }
    
    *{
      box-sizing:border-box;
      font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;
    }
    
    html{
      margin:0;
      padding:0;
      height:100%;
      background:var(--bg);
      color:var(--text);
    }
    
    body{
      margin:0;
      padding:0;
      min-height:100vh;
      color:var(--text);
      display:flex;
      flex-direction:column;
      background:radial-gradient(ellipse 80% 50% at 50% -20%, rgba(0,136,255,0.12), transparent),
                 radial-gradient(ellipse 60% 50% at 50% 120%, rgba(0,217,255,0.08), transparent);
      transition:background 0.3s ease, color 0.3s ease;
    }
    
    [data-theme="light"] body{
      background:radial-gradient(ellipse 80% 50% at 50% -20%, rgba(0,136,255,0.04), transparent),
                 radial-gradient(ellipse 60% 50% at 50% 120%, rgba(0,217,255,0.03), transparent);
    }
    
    .container{
      max-width:1100px;
      margin:0 auto;
      padding:0 24px;
      width:100%;
    }
    
    .card{
      background:var(--gradient-card);
      backdrop-filter:blur(12px);
      border-radius:16px;
      padding:32px;
      margin:20px 0;
      border:1px solid var(--line);
      box-shadow:var(--shadow-md);
      transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card:hover{
      border-color:var(--line-bright);
      box-shadow:var(--shadow-lg);
      transform:translateY(-2px);
    }
    
    .row{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
      align-items:center;
    }
    
    input,select,textarea{
      padding:14px 16px;
      border-radius:10px;
      border:1.5px solid var(--line);
      background:var(--surface);
      color:var(--text);
      font-size:15px;
      font-weight:500;
      transition:all 0.2s ease;
      flex:1;
      min-width:140px;
    }
    
    input:focus,select:focus,textarea:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(63,185,80,0.15);
      background:var(--bg-elevated);
    }
    
    input::placeholder{
      color:var(--muted);
    }
    
    button{
      padding:14px 28px;
      border-radius:10px;
      border:none;
      background:var(--gradient-primary);
      color:var(--bg);
      font-weight:700;
      font-size:15px;
      cursor:pointer;
      transition:all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow:var(--shadow-md), var(--shadow-glow);
      min-height:48px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      letter-spacing:0.3px;
      position:relative;
      overflow:hidden;
    }
    
    button::before{
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background:linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
      opacity:0;
      transition:opacity 0.3s;
    }
    
    button:hover{
      transform:translateY(-3px);
      box-shadow:var(--shadow-lg), 0 0 30px rgba(63,185,80,0.4);
    }
    
    button:hover::before{
      opacity:1;
    }
    
    button:active{
      transform:translateY(-1px);
    }
    
    h1{
      font-size:56px;
      margin:0;
      font-weight:900;
      letter-spacing:-2px;
      background:var(--gradient-primary);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      line-height:1.1;
    }
    
    .logo{
      font-family:'Kola', sans-serif;
      font-size:96px;
      margin:0;
      font-weight:400;
      letter-spacing:-3px;
      background:var(--gradient-primary);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      line-height:1;
      text-transform:uppercase;
    }
    
    @media (max-width:768px){
      .logo{font-size:72px;letter-spacing:-2px}
    }
    
    @media (max-width:480px){
      .logo{font-size:56px;letter-spacing:-1.5px}
    }
    
    h3{
      margin:0 0 20px 0;
      font-size:28px;
      font-weight:700;
      color:var(--text-bright);
      letter-spacing:-0.5px;
    }
    
    h4{
      margin:0 0 16px 0;
      font-size:17px;
      font-weight:700;
      color:var(--accent);
      letter-spacing:0.3px;
      text-transform:uppercase;
      font-size:13px;
    }
    
    p{
      line-height:1.7;
      margin:0 0 16px 0;
      color:var(--text);
    }
    
    .muted{
      color:var(--muted);
      font-size:14px;
    }
    
    .hide{display:none!important}
    .ok{color:var(--success)}
    .err{color:var(--error)}
    
    ul{
      margin:0;
      padding-left:24px;
    }
    
    li{
      margin:14px 0;
      line-height:1.7;
    }
    
    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:24px;
      width:100%;
      max-width:600px;
    }
    
    @media (min-width:720px){
      .grid{grid-template-columns:1fr 1fr}
    }
    
    .block-btn{
      width:100%;
      padding:16px;
      font-size:16px;
    }
    
    #splash{
      position:fixed;
      inset:0;
      background:var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:999;
    }
    
    #splash .pulse{
      width:20px;
      height:20px;
      border-radius:50%;
      background:var(--accent);
      box-shadow:0 0 30px var(--accent);
      animation:pulse 1.5s ease-in-out infinite;
    }
    
    @keyframes pulse{
      0%, 100%{transform:scale(0.8);opacity:0.6}
      50%{transform:scale(1.4);opacity:1}
    }
    
    .menu-container{
      position:fixed;
      top:24px;
      right:24px;
      z-index:10000;
      display:none;
    }
    
    .menu-icon{
      font-size:24px;
      cursor:pointer;
      color:var(--text-bright);
      user-select:none;
      background:var(--card);
      border:1px solid var(--line);
      border-radius:10px;
      padding:10px 12px;
      box-shadow:var(--shadow-md);
      transition:all 0.2s;
    }
    
    .menu-icon:hover{
      border-color:var(--accent);
      box-shadow:var(--shadow-lg);
    }
    
    .menu{
      flex-direction:column;
      position:fixed;
      right:24px;
      top:72px;
      background:var(--card);
      border:1px solid var(--line-bright);
      border-radius:12px;
      box-shadow:var(--shadow-lg);
      padding:8px;
      min-width:220px;
      z-index:9999;
      display:none;
    }
    
    .menu.active{display:flex!important}
    
    .menu a{
      color:var(--text);
      text-decoration:none;
      padding:12px 16px;
      display:block;
      font-weight:600;
      font-size:14px;
      border-radius:8px;
      transition:all 0.2s;
    }
    
    .menu a:hover{
      background:rgba(63,185,80,0.15);
      color:var(--accent);
    }
    
    .app-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:32px 0 24px 0;
      flex-wrap:wrap;
    }
    
    .app-header .brand{
      display:flex;
      align-items:center;
      gap:16px;
    }
    
    .field-label{
      font-size:12px;
      color:var(--muted);
      margin:0 0 8px 0;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:1px;
    }
    
    section.card{
      margin:32px 0;
    }
    
    #loginMsg,#signupMsg,#uploadMsg,#analyzeStatus{
      margin:16px 0;
      padding:14px 16px;
      border-radius:10px;
      font-size:14px;
      font-weight:600;
      border:1px solid transparent;
    }
    
    #loginMsg.ok,#signupMsg.ok,#uploadMsg.ok,#analyzeStatus.ok{
      background:rgba(63,185,80,0.1);
      color:var(--success);
      border-color:var(--success);
    }
    
    #loginMsg.err,#signupMsg.err,#uploadMsg.err,#analyzeStatus.err{
      background:rgba(248,81,73,0.1);
      color:var(--error);
      border-color:var(--error);
    }
    
    .metric-card{
      background:rgba(63,185,80,0.08);
      border:1px solid var(--line);
      border-left:4px solid var(--accent);
      padding:20px;
      border-radius:12px;
      margin:12px 0;
      transition:all 0.2s;
    }
    
    .metric-card:hover{
      background:rgba(63,185,80,0.12);
      border-left-width:6px;
    }
    
    .metric-label{
      font-size:11px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:1.2px;
      font-weight:700;
    }
    
    .metric-value{
      font-size:32px;
      font-weight:800;
      color:var(--accent);
      margin:8px 0 0 0;
      letter-spacing:-1px;
    }
    
    @media (max-width:768px){
      .container{padding:0 16px}
      h1{font-size:40px}
      h3{font-size:24px}
      .card{padding:24px}
      section.card{margin:20px 0}
      input, select, textarea{font-size:16px !important}
    }
    
    @media (max-width:480px){
      h1{font-size:32px}
      h3{font-size:20px}
      .card{padding:20px}
      button{padding:12px 20px;font-size:14px}
      input, select, textarea{font-size:16px !important}
    }
    
    /* iOS Safari specific fixes */
    @supports (-webkit-touch-callout: none) {
      body{-webkit-text-size-adjust:100%}
      input, select, textarea{-webkit-appearance:none;border-radius:8px}
      button{-webkit-tap-highlight-color:rgba(0,217,255,0.2)}
    }
    
    /* Prevent zoom on input focus for iPhone */
    @media screen and (max-width: 768px) {
      input:focus, select:focus, textarea:focus{font-size:16px !important}
    }
  </style>
</head>
<body>
  <!-- Hamburger Menu (only after login) -->
  <div class="menu-container">
    <div class="menu-icon" id="menuIcon" aria-label="Open menu" role="button">&#9776;</div>
  <!-- Menu links -->
    <div class="menu" id="menu" role="menu">
      <a href="#" id="profileLink" role="menuitem">Profile</a>
      <a href="#" id="newAnalysis" role="menuitem">New Analysis</a>
      <a href="#" id="library" role="menuitem">Library</a>
      <a href="#" id="logout" role="menuitem">Logout</a>
    </div>
  </div>

  <!-- Splash -->
  <div id="splash"><div class="pulse"></div></div>

  <!-- Header -->
  <header class="container app-header">
    <div class="brand">
      <h1 class="logo" style="font-size:42px">‚öΩ BALL KNOWLEDGE</h1>
      <p class="muted" style="margin:0;font-size:12px">Personal Soccer Training Analysis</p>
    </div>
    <nav aria-label="breadcrumbs" style="display:flex;align-items:center;gap:16px">
      <button id="themeToggle" onclick="toggleTheme()" style="background:var(--card);border:1px solid var(--line);color:var(--text);padding:8px 16px;border-radius:8px;cursor:pointer;font-size:14px;transition:all 0.3s ease;display:flex;align-items:center;gap:8px" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--line)'">
        <span id="themeIcon">üåô</span>
        <span id="themeText">Dark</span>
      </button>
      <a id="pageTag" class="muted" style="text-decoration:none;font-size:14px">Account</a>
    </nav>
  </header>

  <!-- =========== HOME/LANDING PAGE =========== -->
  <section class="container hide" id="homePage" style="padding:40px 20px">
    <!-- Hero Section -->
    <div style="text-align:center;padding:80px 20px 60px">
      <h1 class="logo" style="margin-bottom:20px;font-size:120px;line-height:1">‚öΩ BALL KNOWLEDGE</h1>
      <p style="font-size:28px;line-height:1.4;margin:0 auto 40px;max-width:700px;color:var(--muted);font-weight:500">
        Analyze. Improve. Dominate.
      </p>
      <button onclick="setHash('login'); goTo('login')" class="btn-primary" style="padding:22px 60px;font-size:22px;min-height:70px;font-weight:800;box-shadow:0 8px 30px rgba(63,185,80,0.4);text-transform:uppercase;letter-spacing:1px">
        Start Free Analysis ‚Üí
      </button>
    </div>

    <!-- Features Grid -->
    <div style="max-width:1000px;margin:80px auto">
      <h2 style="text-align:center;font-size:42px;margin-bottom:16px;background:var(--gradient-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">How It Works</h2>
      <p style="text-align:center;color:var(--muted);font-size:18px;margin-bottom:60px">Three simple steps to level up your game</p>
      
      <div style="display:grid;gap:32px">
        <div class="card" style="display:flex;gap:32px;align-items:center;padding:40px;transition:all 0.3s ease" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
          <div style="flex-shrink:0;width:80px;height:80px;background:linear-gradient(135deg,rgba(63,185,80,0.2),rgba(88,166,255,0.2));border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:48px">üìπ</div>
          <div style="flex:1">
            <h3 style="margin:0 0 12px 0;font-size:24px;color:var(--accent)">1. Upload Your Video</h3>
            <p style="margin:0;color:var(--muted);font-size:16px;line-height:1.6">Record yourself during training or a game. Drag and drop your video or paste a YouTube link. That's it.</p>
          </div>
        </div>
        
        <div class="card" style="display:flex;gap:32px;align-items:center;padding:40px;transition:all 0.3s ease" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
          <div style="flex-shrink:0;width:80px;height:80px;background:linear-gradient(135deg,rgba(63,185,80,0.2),rgba(88,166,255,0.2));border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:48px">ü§ñ</div>
          <div style="flex:1">
            <h3 style="margin:0 0 12px 0;font-size:24px;color:var(--accent)">2. AI Analyzes Every Frame</h3>
            <p style="margin:0;color:var(--muted);font-size:16px;line-height:1.6">GPT-5.2 Vision AI breaks down your technique, positioning, decision-making, and identifies your best moments.</p>
          </div>
        </div>
        
        <div class="card" style="display:flex;gap:32px;align-items:center;padding:40px;transition:all 0.3s ease" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
          <div style="flex-shrink:0;width:80px;height:80px;background:linear-gradient(135deg,rgba(63,185,80,0.2),rgba(88,166,255,0.2));border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:48px">üéØ</div>
          <div style="flex:1">
            <h3 style="margin:0 0 12px 0;font-size:24px;color:var(--accent)">3. Get Actionable Feedback</h3>
            <p style="margin:0;color:var(--muted);font-size:16px;line-height:1.6">Receive position-specific insights, priority improvements, highlight reels, and detailed technical analysis.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- CTA Section -->
    <div style="text-align:center;padding:80px 20px;max-width:800px;margin:0 auto">
      <h2 style="font-size:48px;margin-bottom:24px;line-height:1.2">Ready to Take Your<br>Game to the Next Level?</h2>
      <p style="font-size:20px;color:var(--muted);margin-bottom:40px">Join thousands of players improving their skills with AI-powered analysis</p>
      <button onclick="setHash('login'); goTo('login')" class="btn-primary" style="padding:22px 60px;font-size:22px;min-height:70px;font-weight:800;box-shadow:0 8px 30px rgba(63,185,80,0.4);text-transform:uppercase;letter-spacing:1px">
        Get Started Free ‚Üí
      </button>
    </div>
  </section>

  <!-- =========== LOGIN PAGE =========== -->
  <section class="card container hide" id="loginCard" style="max-width:500px">
    <h3>Welcome Back</h3>
    <p class="muted">Login to access your training analysis</p>
    
    <div style="margin:24px 0">
      <div class="row" style="flex-direction:column;gap:12px">
        <input id="li_email" type="email" placeholder="Email" style="width:100%">
        <input id="li_password" type="password" placeholder="Password" style="width:100%">
      </div>
      <button id="loginBtn" class="block-btn" style="margin-top:16px">Login</button>
    </div>

    <p id="loginMsg" class="muted" style="margin:16px 0"></p>
    
    <div style="text-align:center;margin-top:24px;padding-top:24px;border-top:1px solid var(--line)">
      <p class="muted" style="margin-bottom:12px">Don't have an account?</p>
      <button onclick="setHash('signup'); goTo('signup')" style="background:transparent;border:1.5px solid var(--accent);color:var(--accent);padding:12px 32px">
        Create Account
      </button>
    </div>
  </section>

  <!-- =========== SIGNUP PAGE =========== -->
  <section class="card container hide" id="signupCard" style="max-width:500px">
    <h3>Create Your Account</h3>
    <p class="muted">Start analyzing your game today</p>
    
    <div style="margin:24px 0">
      <div class="row" style="flex-direction:column;gap:12px">
        <input id="su_name" type="text" placeholder="Full name" style="width:100%">
        <input id="su_email" type="email" placeholder="Email" style="width:100%">
        <input id="su_password" type="password" placeholder="Create password" style="width:100%">
        <div style="width:100%">
          <label for="su_dob" style="display:block;margin-bottom:6px;color:var(--muted);font-size:14px">Date of Birth</label>
          <input id="su_dob" type="date" style="width:100%">
        </div>
      </div>
      <button id="signupBtn" class="block-btn" style="margin-top:16px">Sign Up</button>
    </div>

    <p id="signupMsg" class="muted" style="margin:16px 0"></p>
    
    <div style="text-align:center;margin-top:24px;padding-top:24px;border-top:1px solid var(--line)">
      <p class="muted" style="margin-bottom:12px">Already have an account?</p>
      <button onclick="setHash('login'); goTo('login')" style="background:transparent;border:1.5px solid var(--accent);color:var(--accent);padding:12px 32px">
        Login
      </button>
    </div>
  </section>

  <!-- =========== ANALYSIS (after login) =========== -->
  <section class="card container hide" id="analysisCard">
    <h3>New Training Analysis</h3>
    
    <!-- Video Type Selection (TOP) -->
    <div class="card">
      <h4>What are you analyzing?</h4>
      <div class="row" style="flex-direction:column;align-items:flex-start;gap:8px">
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
          <input type="radio" id="videoType_game" name="videoType" value="game" checked style="width:auto;flex:none" onchange="updateFormFields()">
          <span><strong>Game Video</strong> - Official match footage</span>
        </label>
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
          <input type="radio" id="videoType_training" name="videoType" value="training" style="width:auto;flex:none" onchange="updateFormFields()">
          <span><strong>Training Video</strong> - Drills & skill work</span>
        </label>
      </div>
    </div>
    
    <div class="grid">
      <!-- Game Video Fields -->
      <div id="gameFields" class="card" style="margin:0">
        <h4>Game Information</h4>
        <div class="row">
          <input id="cand_name" type="text" placeholder="Player name">
          <select id="cand_position" style="flex:1;min-width:140px">
            <option value="">Select Position</option>
            <option value="Goalkeeper">Goalkeeper</option>
            <option value="Right Back">Right Back</option>
            <option value="Center Back">Center Back</option>
            <option value="Left Back">Left Back</option>
            <option value="Defensive Mid">Defensive Mid</option>
            <option value="Central Mid">Central Mid</option>
            <option value="Attacking Mid">Attacking Mid</option>
            <option value="Right Wing">Right Wing</option>
            <option value="Left Wing">Left Wing</option>
            <option value="Striker">Striker</option>
          </select>
        </div>
        <div class="row">
          <input id="cand_jersey" type="number" placeholder="Jersey #" required>
          <input id="cand_age" type="number" placeholder="Age (optional)">
        </div>
        <div class="row">
          <select id="cand_jersey_color" required style="flex:1;min-width:140px">
            <option value="">Jersey Color</option>
            <option value="white">White</option>
            <option value="black">Black</option>
            <option value="red">Red</option>
            <option value="blue">Blue</option>
            <option value="green">Green</option>
            <option value="yellow">Yellow</option>
            <option value="orange">Orange</option>
            <option value="purple">Purple</option>
            <option value="gray">Gray</option>
            <option value="other">Other</option>
          </select>
        </div>
        <p class="muted" style="margin-top:8px">Jersey number and color help identify the player on the field, especially when both teams have players with the same number.</p>
      </div>

      <!-- Training Video Fields -->
      <div id="trainingFields" class="card hide" style="margin:0">
        <h4>Training Information</h4>
        <div class="row">
          <input id="train_name" type="text" placeholder="Your name">
          <select id="train_position" style="flex:1;min-width:140px">
            <option value="">Select Position</option>
            <option value="Goalkeeper">Goalkeeper</option>
            <option value="Right Back">Right Back</option>
            <option value="Center Back">Center Back</option>
            <option value="Left Back">Left Back</option>
            <option value="Defensive Mid">Defensive Mid</option>
            <option value="Central Mid">Central Mid</option>
            <option value="Attacking Mid">Attacking Mid</option>
            <option value="Right Wing">Right Wing</option>
            <option value="Left Wing">Left Wing</option>
            <option value="Striker">Striker</option>
          </select>
        </div>
        <div class="row">
          <input id="train_focus" type="text" placeholder="What skill/drill? (optional)">
        </div>
        <p class="muted" style="margin-top:8px">Tell us what you're working on to get more targeted feedback.</p>
      </div>
    </div>

    <!-- Video Upload -->
    <div class="card">
      <h4 style="margin-bottom:16px">Upload Video</h4>
      
      <!-- Upload Method Selector -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px">
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;padding:12px 14px;border:1.5px solid var(--line);border-radius:8px;background:rgba(0,255,149,0.05);min-height:44px">
          <input type="radio" name="uploadMethod" value="file" checked style="cursor:pointer;width:18px;height:18px;flex:none"> <span style="font-size:14px">üì± Upload Video</span>
        </label>
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;padding:12px 14px;border:1.5px solid var(--line);border-radius:8px;min-height:44px">
          <input type="radio" name="uploadMethod" value="url" style="cursor:pointer;width:18px;height:18px;flex:none"> <span style="font-size:14px">üîó Video URL</span>
        </label>
      </div>
      
      <p class="muted" style="margin-bottom:16px;font-size:13px;padding:10px;background:rgba(0,255,149,0.05);border-left:3px solid var(--accent);border-radius:4px">
        üì± <strong>Upload Video:</strong> Training clips from your phone (uploads to cloud, max 100MB)<br>
        üîó <strong>Video URL:</strong> Paste Cloudinary, YouTube, or Vimeo link for game footage
      </p>

      <!-- File Upload Section -->
      <div id="fileUploadSection" class="hide">
        <div id="dropZone" style="border:2px dashed var(--accent);border-radius:12px;padding:28px 16px;text-align:center;cursor:pointer;transition:all 0.3s;margin-bottom:14px;background:rgba(0,255,149,0.02);min-height:140px;display:flex;flex-direction:column;justify-content:center">
          <div style="font-size:40px;margin-bottom:10px">üì± üìπ</div>
          <p style="margin:0 0 6px 0;font-weight:600;color:var(--accent);font-size:16px">Select Video</p>
          <p class="muted" style="margin:0;font-size:13px;line-height:1.5">Tap a button or drag &<br>drop on desktop</p>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px">
          <button type="button" onclick="document.getElementById('videoLibraryInput').click()" style="margin:0;padding:14px 12px;font-size:15px;min-height:50px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px">
            <span style="font-size:24px">üì∏</span>
            <span style="font-weight:600">Library</span>
          </button>
          <button type="button" onclick="document.getElementById('videoCameraInput').click()" style="margin:0;padding:14px 12px;font-size:15px;min-height:50px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px">
            <span style="font-size:24px">üé•</span>
            <span style="font-weight:600">Record</span>
          </button>
        </div>
        <input id="videoLibraryInput" type="file" accept="video/*" style="display:none">
        <input id="videoCameraInput" type="file" accept="video/*" capture="environment" style="display:none">
        <div id="fileInfo" class="muted" style="font-size:14px;margin:12px 0;padding:12px;border-radius:8px;background:rgba(0,0,0,0.3);line-height:1.5"></div>
      </div>

      <!-- URL Upload Section -->
      <div id="urlUploadSection" class="hide">
        <div style="display:grid;gap:14px;padding:8px 0">
          <div>
            <label class="field-label" style="display:block;margin-bottom:8px;font-size:14px;font-weight:600">Video URL</label>
            <input id="videoUrl" type="text" placeholder="Paste YouTube, Vimeo, or Cloudinary URL" style="font-size:16px">
          </div>
          <div>
            <label class="field-label" style="display:block;margin-bottom:8px;font-size:14px;font-weight:600">Duration (seconds)</label>
            <input id="videoDuration" type="number" placeholder="Video duration" step="0.1" style="font-size:16px">
          </div>
        </div>
      </div>

      <p id="uploadMsg" class="muted" style="margin-top:14px;font-size:13px"></p>
    </div>

    <!-- Analyze Button -->
    <div class="row" style="margin-top:16px">
      <button id="analyzeBtn" class="block-btn" style="flex:1">Get Feedback</button>
      <span id="analyzeStatus" class="muted" style="flex:1;margin-left:12px"></span>
    </div>

    <!-- Results -->
    <div id="results" class="hide" style="margin-top:24px">
      <h3>Your Coaching Report</h3>
      
      <!-- Summary -->
      <div class="card" style="margin:24px 0">
        <h4>üìã Session Summary</h4>
        <p id="summary" style="line-height:1.8;color:var(--text)">‚Äî</p>
      </div>

      <!-- TRAINING VIDEO RESULTS -->
      <div id="trainingResults" class="hide">
        <!-- Skill Focus -->
        <div class="card" style="margin:24px 0">
          <h4>üéØ Skill Focus</h4>
          <p id="skillFocus" style="font-size:18px;font-weight:600;color:var(--accent);margin:0 0 8px 0">‚Äî</p>
          <p id="skillRecognition" style="color:var(--text);line-height:1.6">‚Äî</p>
        </div>

        <!-- Technical Analysis -->
        <div class="card" style="margin:24px 0">
          <h4>üî¨ Technical Analysis</h4>
          <div id="technicalAnalysis" style="display:grid;gap:16px;margin-top:12px">
            <div>
              <p class="field-label">Footwork</p>
              <p id="techFootwork" style="color:var(--text);line-height:1.6;margin:0">‚Äî</p>
            </div>
            <div>
              <p class="field-label">Body Position</p>
              <p id="techBodyPosition" style="color:var(--text);line-height:1.6;margin:0">‚Äî</p>
            </div>
            <div>
              <p class="field-label">Follow Through</p>
              <p id="techFollowThrough" style="color:var(--text);line-height:1.6;margin:0">‚Äî</p>
            </div>
            <div>
              <p class="field-label">Consistency</p>
              <p id="techConsistency" style="color:var(--text);line-height:1.6;margin:0">‚Äî</p>
            </div>
            <div>
              <p class="field-label">Session Progression</p>
              <p id="techProgression" style="color:var(--text);line-height:1.6;margin:0">‚Äî</p>
            </div>
          </div>
        </div>

        <!-- Current Level & Tips -->
        <div class="row" style="gap:16px;margin-bottom:24px;flex-wrap:wrap">
          <div class="card" style="flex:1;min-width:280px">
            <h4>üìä Current Level</h4>
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
              <div style="font-size:32px;font-weight:700;color:var(--accent)" id="skillGrade">7</div>
              <p id="skillLevelDesc" style="margin:0;color:var(--text)">Assessment</p>
            </div>
          </div>
          <div class="card" style="flex:1;min-width:280px">
            <h4>üí° Top 4 Improvements (Priority Order)</h4>
            <ul id="improvementTips" style="padding-left:20px;color:var(--text);margin:0"></ul>
          </div>
        </div>

        <!-- Common Mistakes -->
        <div class="card" style="margin:24px 0">
          <h4>‚ö†Ô∏è Common Mistakes for Your Position</h4>
          <ul id="commonMistakes" style="padding-left:20px;color:var(--text);margin:0"></ul>
        </div>

        <!-- Practice Progression -->
        <div class="card" style="margin:24px 0">
          <h4>üìà Practice Progression</h4>
          <div id="progressionList" style="display:flex;flex-direction:column;gap:14px"></div>
        </div>

        <!-- YouTube Recommendations -->
        <div class="card" style="margin:24px 0">
          <h4>üé¨ YouTube Videos to Watch</h4>
          <div id="youtubeList" style="display:flex;flex-direction:column;gap:12px"></div>
        </div>
      </div>

      <!-- GAME VIDEO RESULTS -->
      <div id="gameResults" class="hide">
        <!-- Player Grade -->
        <div class="card" style="margin:24px 0">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
            <h4 style="margin:0">Overall Performance</h4>
            <div style="font-size:48px;font-weight:700;color:var(--accent)" id="playerGrade">7</div>
          </div>
          <p id="gameSmry" style="color:var(--text);line-height:1.6">‚Äî</p>
        </div>

        <!-- Player Stats -->
        <div class="row" style="gap:12px;margin-bottom:24px;flex-wrap:wrap">
          <div class="card" style="flex:1;min-width:180px">
            <h4 style="color:var(--accent2);font-size:14px">Passes</h4>
            <div style="font-size:28px;font-weight:700;color:var(--text)" id="statPasses">0</div>
          </div>
          <div class="card" style="flex:1;min-width:180px">
            <h4 style="color:var(--accent2);font-size:14px">Shots</h4>
            <div style="font-size:28px;font-weight:700;color:var(--text)" id="statShots">0</div>
          </div>
          <div class="card" style="flex:1;min-width:180px">
            <h4 style="color:var(--accent2);font-size:14px">Tackles</h4>
            <div style="font-size:28px;font-weight:700;color:var(--text)" id="statTackles">0</div>
          </div>
          <div class="card" style="flex:1;min-width:180px">
            <h4 style="color:var(--accent2);font-size:14px">Interceptions</h4>
            <div style="font-size:28px;font-weight:700;color:var(--text)" id="statInterceptions">0</div>
          </div>
        </div>

        <!-- Pass Metrics -->
        <div class="card" style="margin:24px 0">
          <h4>‚öΩ Passing Metrics</h4>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Attempts</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="passAttempts">0</p>
            </div>
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Completed</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="passCompleted">0</p>
            </div>
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Accuracy</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="passAccuracy">0%</p>
            </div>
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Key Passes</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="keyPasses">0</p>
            </div>
          </div>
        </div>

        <!-- Shot Metrics -->
        <div class="card" style="margin:24px 0">
          <h4>üéØ Shot Metrics</h4>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Shot Attempts</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="shotAttempts">0</p>
            </div>
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">On Target</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="shotOnTarget">0</p>
            </div>
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Goals</p>
              <p style="font-size:20px;font-weight:700;color:var(--success)" id="shotGoals">0</p>
            </div>
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Accuracy</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="shotAccuracy">0%</p>
            </div>
          </div>
        </div>

        <!-- Defensive Metrics -->
        <div class="card" style="margin:24px 0">
          <h4>üõ°Ô∏è Defensive Metrics</h4>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Tackles</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="defTackles">0</p>
            </div>
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Interceptions</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="defInterceptions">0</p>
            </div>
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Clearances</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="defClearances">0</p>
            </div>
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Success Rate</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="defSuccessRate">0%</p>
            </div>
          </div>
        </div>

        <!-- Ball Control -->
        <div class="card" style="margin:24px 0">
          <h4>üéÆ Ball Control</h4>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Touches</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="ballTouches">0</p>
            </div>
            <div>
              <p class="muted" style="font-size:12px;margin-bottom:4px">Possession Time</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="ballPossession">0s</p>
            </div>
            <div colspan="2">
              <p class="muted" style="font-size:12px;margin-bottom:4px">Dribble Success</p>
              <p style="font-size:20px;font-weight:700;color:var(--accent)" id="ballSuccess">0%</p>
            </div>
          </div>
        </div>

        <!-- Strengths & Areas to Improve -->
        <div class="row" style="gap:16px;margin-bottom:24px;flex-wrap:wrap">
          <div class="card" style="flex:1;min-width:280px">
            <h4>üí™ Strengths</h4>
            <ul id="strengths" style="padding-left:20px;color:var(--text);margin:0"></ul>
          </div>
          <div class="card" style="flex:1;min-width:280px">
            <h4>üìç Areas to Improve</h4>
            <ul id="areasToImprove" style="padding-left:20px;color:var(--text);margin:0"></ul>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="row" style="gap:8px">
        <button id="newAnalysisBtn" style="flex:1">Analyze Another Video</button>
        <button id="saveAnalysisBtn" style="flex:1">Save Report</button>
      </div>
    </div>
  </section>

  <!-- =========== LIBRARY PAGE =========== -->
  <section class="card container hide" id="libraryPage">
    <h3>Your Training Reports</h3>
    <p class="muted">Saved coaching reports</p>
    <div id="libraryList"></div>
  </section>

  <!-- =========== REPORT VIEW PAGE =========== -->
  <section class="card container hide" id="reportViewPage">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
      <h3 style="margin:0">Analysis Report</h3>
      <button onclick="setHash('library'); goTo('library')" style="padding:10px 20px;font-size:14px">‚Üê Back to Library</button>
    </div>

    <div id="reportViewContent">
      <!-- YouTube Video Player -->
      <div id="viewYoutubeSection" class="card" style="margin:24px 0">
        <h4>üìπ Video</h4>
        <div id="viewYoutubePlayer" style="margin-top:12px">
          <p class="muted">No video available</p>
        </div>
      </div>

      <!-- Summary -->
      <div class="card" style="margin:24px 0">
        <h4>üìã Session Summary</h4>
        <p id="viewSummary" style="line-height:1.8;color:var(--text)">‚Äî</p>
      </div>

      <!-- TRAINING VIDEO RESULTS -->
      <div id="viewTrainingResults" class="hide">
        <!-- Skill Focus -->
        <div class="card" style="margin:24px 0">
          <h4>üéØ Skill Focus</h4>
          <p id="viewSkillFocus" style="font-size:18px;font-weight:600;color:var(--accent);margin:0 0 8px 0">‚Äî</p>
          <p id="viewSkillRecognition" style="color:var(--text);line-height:1.6">‚Äî</p>
        </div>

        <!-- Technical Analysis -->
        <div class="card" style="margin:24px 0">
          <h4>üî¨ Technical Analysis</h4>
          <div style="display:grid;gap:16px;margin-top:12px">
            <div>
              <p class="field-label">Footwork</p>
              <p id="viewTechFootwork" style="color:var(--text);line-height:1.6;margin:0">‚Äî</p>
            </div>
            <div>
              <p class="field-label">Body Position</p>
              <p id="viewTechBodyPosition" style="color:var(--text);line-height:1.6;margin:0">‚Äî</p>
            </div>
            <div>
              <p class="field-label">Follow Through</p>
              <p id="viewTechFollowThrough" style="color:var(--text);line-height:1.6;margin:0">‚Äî</p>
            </div>
            <div>
              <p class="field-label">Consistency</p>
              <p id="viewTechConsistency" style="color:var(--text);line-height:1.6;margin:0">‚Äî</p>
            </div>
            <div>
              <p class="field-label">Session Progression</p>
              <p id="viewTechProgression" style="color:var(--text);line-height:1.6;margin:0">‚Äî</p>
            </div>
          </div>
        </div>

        <!-- Current Level -->
        <div class="card" style="margin:24px 0">
          <h4>üìä Current Level</h4>
          <div class="metric-card">
            <div class="metric-label">Grade</div>
            <div id="viewSkillGrade" class="metric-value">‚Äî</div>
          </div>
          <p id="viewSkillLevelDesc" style="line-height:1.8;margin-top:12px;color:var(--text)">‚Äî</p>
        </div>

        <!-- Improvement Tips -->
        <div class="card" style="margin:24px 0">
          <h4>üí° Top 4 Improvements (Priority Order)</h4>
          <ul id="viewImprovementTips" style="padding-left:20px;color:var(--text);margin:0">
            <li>No tips available</li>
          </ul>
        </div>

        <!-- Common Mistakes -->
        <div class="card" style="margin:24px 0">
          <h4>‚ö†Ô∏è Common Mistakes for Your Position</h4>
          <ul id="viewCommonMistakes" style="padding-left:20px;color:var(--text);margin:0">
            <li>No mistakes data</li>
          </ul>
        </div>

        <!-- Practice Progression -->
        <div class="card" style="margin:24px 0">
          <h4>üìà Practice Progression</h4>
          <div id="viewProgressionList" style="display:flex;flex-direction:column;gap:14px"></div>
        </div>

        <!-- YouTube Recommendations -->
        <div class="card" style="margin:24px 0">
          <h4>üé¨ YouTube Videos to Watch</h4>
          <div id="viewYoutubeList" style="display:flex;flex-direction:column;gap:12px"></div>
        </div>
      </div>

      <!-- GAME VIDEO RESULTS -->
      <div id="viewGameResults" class="hide">
        <!-- Player Grade -->
        <div class="card" style="margin:24px 0">
          <h4>Overall Performance Grade</h4>
          <div class="metric-card">
            <div class="metric-label">Grade</div>
            <div id="viewPlayerGrade" class="metric-value">‚Äî</div>
          </div>
          <p id="viewGameSmry" style="line-height:1.8;margin-top:12px;color:var(--text)">‚Äî</p>
        </div>

        <!-- Player Stats -->
        <div class="card" style="margin:24px 0">
          <h4>Player Statistics</h4>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-top:12px">
            <div class="metric-card"><div class="metric-label">Passes</div><div id="viewStatPasses" class="metric-value">0</div></div>
            <div class="metric-card"><div class="metric-label">Shots</div><div id="viewStatShots" class="metric-value">0</div></div>
            <div class="metric-card"><div class="metric-label">Tackles</div><div id="viewStatTackles" class="metric-value">0</div></div>
            <div class="metric-card"><div class="metric-label">Interceptions</div><div id="viewStatInterceptions" class="metric-value">0</div></div>
          </div>
        </div>

        <!-- Pass Metrics -->
        <div class="card" style="margin:24px 0">
          <h4>Pass Metrics</h4>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-top:12px">
            <div class="metric-card"><div class="metric-label">Attempts</div><div id="viewPassAttempts" class="metric-value">0</div></div>
            <div class="metric-card"><div class="metric-label">Completed</div><div id="viewPassCompleted" class="metric-value">0</div></div>
            <div class="metric-card"><div class="metric-label">Accuracy</div><div id="viewPassAccuracy" class="metric-value">0%</div></div>
            <div class="metric-card"><div class="metric-label">Key Passes</div><div id="viewKeyPasses" class="metric-value">0</div></div>
          </div>
        </div>

        <!-- Shot Metrics -->
        <div class="card" style="margin:24px 0">
          <h4>Shot Metrics</h4>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-top:12px">
            <div class="metric-card"><div class="metric-label">Attempts</div><div id="viewShotAttempts" class="metric-value">0</div></div>
            <div class="metric-card"><div class="metric-label">On Target</div><div id="viewShotOnTarget" class="metric-value">0</div></div>
            <div class="metric-card"><div class="metric-label">Goals</div><div id="viewShotGoals" class="metric-value">0</div></div>
            <div class="metric-card"><div class="metric-label">Accuracy</div><div id="viewShotAccuracy" class="metric-value">0%</div></div>
          </div>
        </div>

        <!-- Defensive Metrics -->
        <div class="card" style="margin:24px 0">
          <h4>Defensive Metrics</h4>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-top:12px">
            <div class="metric-card"><div class="metric-label">Tackles</div><div id="viewDefTackles" class="metric-value">0</div></div>
            <div class="metric-card"><div class="metric-label">Interceptions</div><div id="viewDefInterceptions" class="metric-value">0</div></div>
            <div class="metric-card"><div class="metric-label">Clearances</div><div id="viewDefClearances" class="metric-value">0</div></div>
            <div class="metric-card"><div class="metric-label">Success Rate</div><div id="viewDefSuccessRate" class="metric-value">0%</div></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- =========== PROFILE PAGE (after login) =========== -->
  <section class="card container hide" id="profilePage" aria-labelledby="profileTitle">
    <h3 id="profileTitle" style="margin:0 0 24px 0">Your Profile</h3>
    
    <div id="profileViewMode">
      <div id="profileContent" style="display:grid;gap:24px">
        <!-- Basic Info Card -->
        <div class="card" style="margin:0">
          <h4 style="margin-top:0">Personal Information</h4>
          <div style="display:grid;gap:16px">
            <div style="padding:12px;background:rgba(0,255,149,0.08);border-radius:10px;border-left:3px solid var(--accent)">
              <div class="muted" style="font-size:12px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">Name</div>
              <div id="profileName" style="font-size:18px;font-weight:600;color:var(--text)">‚Äî</div>
            </div>
            
            <div style="padding:12px;background:rgba(25,211,255,0.08);border-radius:10px;border-left:3px solid var(--accent2)">
              <div class="muted" style="font-size:12px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">Email</div>
              <div id="profileEmail" style="font-size:16px;color:var(--text);word-break:break-all">‚Äî</div>
            </div>

            <div style="padding:12px;background:rgba(0,255,149,0.08);border-radius:10px;border-left:3px solid var(--accent)">
              <div class="muted" style="font-size:12px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">Age</div>
              <div id="profileAge" style="font-size:18px;font-weight:600;color:var(--text)">‚Äî</div>
            </div>

            <div style="padding:12px;background:rgba(25,211,255,0.08);border-radius:10px;border-left:3px solid var(--accent2)">
              <div class="muted" style="font-size:12px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">Date of Birth</div>
              <div id="profileDOB" style="font-size:16px;color:var(--text)">‚Äî</div>
            </div>
          </div>
        </div>

        <!-- Soccer Profile Card -->
        <div class="card" style="margin:0">
          <h4 style="margin-top:0">Soccer Profile</h4>
          <div style="display:grid;gap:16px">
            <div style="padding:12px;background:rgba(0,255,149,0.08);border-radius:10px;border-left:3px solid var(--accent)">
              <div class="muted" style="font-size:12px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">Position</div>
              <div id="profilePosition" style="font-size:18px;font-weight:600;color:var(--text)">‚Äî</div>
            </div>

            <div style="padding:12px;background:rgba(25,211,255,0.08);border-radius:10px;border-left:3px solid var(--accent2)">
              <div class="muted" style="font-size:12px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">Dominant Foot</div>
              <div id="profileFoot" style="font-size:18px;font-weight:600;color:var(--text)">‚Äî</div>
            </div>

            <div style="padding:12px;background:rgba(0,255,149,0.08);border-radius:10px;border-left:3px solid var(--accent)">
              <div class="muted" style="font-size:12px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">Height</div>
              <div id="profileHeight" style="font-size:18px;font-weight:600;color:var(--text)">‚Äî</div>
            </div>

            <div style="padding:12px;background:rgba(25,211,255,0.08);border-radius:10px;border-left:3px solid var(--accent2)">
              <div class="muted" style="font-size:12px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px">Weight</div>
              <div id="profileWeight" style="font-size:18px;font-weight:600;color:var(--text)">‚Äî</div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <button id="editProfileBtn" style="flex:1;min-width:160px">Edit Profile</button>
          <button id="viewLibraryBtn" style="flex:1;min-width:160px">View Library</button>
        </div>
      </div>
    </div>

    <!-- Edit Mode -->
    <div id="profileEditMode" class="hide">
      <div style="display:grid;gap:24px">
        <!-- Edit Personal Info -->
        <div class="card" style="margin:0">
          <h4 style="margin-top:0">Edit Personal Information</h4>
          <div style="display:grid;gap:12px">
            <div>
              <label class="field-label">Name</label>
              <input id="editName" type="text" placeholder="Full name" style="width:100%">
            </div>
            <div>
              <label class="field-label">Age</label>
              <input id="editAge" type="number" placeholder="Age" style="width:100%">
            </div>
            <div>
              <label class="field-label">Date of Birth</label>
              <input id="editDOB" type="date" style="width:100%">
            </div>
          </div>
        </div>

        <!-- Edit Soccer Profile -->
        <div class="card" style="margin:0">
          <h4 style="margin-top:0">Edit Soccer Profile</h4>
          <div style="display:grid;gap:12px">
            <div>
              <label class="field-label">Position</label>
              <select id="editPosition" style="width:100%">
                <option value="">Select Position</option>
                <option value="Goalkeeper">Goalkeeper</option>
                <option value="Right Back">Right Back</option>
                <option value="Center Back">Center Back</option>
                <option value="Left Back">Left Back</option>
                <option value="Defensive Mid">Defensive Mid</option>
                <option value="Central Mid">Central Mid</option>
                <option value="Attacking Mid">Attacking Mid</option>
                <option value="Right Wing">Right Wing</option>
                <option value="Left Wing">Left Wing</option>
                <option value="Striker">Striker</option>
              </select>
            </div>
            <div>
              <label class="field-label">Dominant Foot</label>
              <select id="editFoot" style="width:100%">
                <option value="">Select Dominant Foot</option>
                <option value="L">Left</option>
                <option value="R">Right</option>
                <option value="B">Both</option>
              </select>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
              <div>
                <label class="field-label">Height (feet)</label>
                <input id="editHeightFeet" type="number" placeholder="e.g., 6" style="width:100%">
              </div>
              <div>
                <label class="field-label">Height (inches)</label>
                <input id="editHeightInches" type="number" placeholder="e.g., 2" style="width:100%">
              </div>
            </div>
            <div>
              <label class="field-label">Weight (lbs)</label>
              <input id="editWeight" type="number" placeholder="e.g., 160" style="width:100%">
            </div>
          </div>
        </div>

        <!-- Edit Buttons -->
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <button id="saveProfileBtn" style="flex:1;min-width:160px">Save Changes</button>
          <button id="cancelEditBtn" style="flex:1;min-width:160px;background:linear-gradient(135deg,#666,#555);box-shadow:0 4px 12px rgba(100,100,100,0.2)">Cancel</button>
        </div>
      </div>
    </div>
  </section>

  <script>
  // Use relative paths - works on Vercel and local file://
  const BASE = location.protocol === 'file:' ? 'http://localhost:3001' : '';

  const $ = (id) => document.getElementById(id);
  const setToken   = (t) => localStorage.setItem('bk_token', t);
  const getToken   = ()  => localStorage.getItem('bk_token');
  const clearToken = ()  => localStorage.removeItem('bk_token');

  function show(el){ if(!el) return; el.classList.remove('hide'); }
  function hide(el){ if(!el) return; el.classList.add('hide'); }

  async function api(path, opts = {}) {
    // Handle FormData for file uploads
    let headers = Object.assign({}, opts.headers || {});
    if (!(opts.body instanceof FormData)) {
      headers['Content-Type'] = 'application/json';
    }
    // Don't set Content-Type for FormData - let browser handle it
    const t = getToken();
    if (t) headers['Authorization'] = 'Bearer ' + t;
    const r = await fetch(`${BASE}${path}`, { ...opts, headers });
    let data;
    try { data = await r.json(); }
    catch { data = { ok:false, error:'Bad response from server' }; }
    return data;
  }

  /* Router */
  function goTo(screen){
    hide($('homePage')); hide($('loginCard')); hide($('signupCard'));
    hide($('analysisCard')); hide($('libraryPage')); hide($('profilePage'));
    hide($('reportViewPage'));

    const menuContainer = document.querySelector('.menu-container');
    
    if (screen === 'home') {
      show($('homePage'));
      if ($('pageTag')) $('pageTag').textContent = 'Home';
      if (menuContainer) menuContainer.style.display = 'none';
    } else if (screen === 'login') {
      show($('loginCard'));
      if ($('pageTag')) $('pageTag').textContent = 'Login';
      if (menuContainer) menuContainer.style.display = 'none';
    } else if (screen === 'signup') {
      show($('signupCard'));
      if ($('pageTag')) $('pageTag').textContent = 'Sign Up';
      if (menuContainer) menuContainer.style.display = 'none';
    } else if (screen === 'profile') {
      show($('profilePage'));
      if ($('pageTag')) $('pageTag').textContent = 'Profile';
      if (menuContainer) menuContainer.style.display = 'block';
      loadProfile();
    } else if (screen === 'analysis') {
      show($('analysisCard'));
      if ($('pageTag')) $('pageTag').textContent = 'Analysis';
      if (menuContainer) menuContainer.style.display = 'block';
    } else if (screen === 'library') {
      show($('libraryPage'));
      if ($('pageTag')) $('pageTag').textContent = 'Library';
      if (menuContainer) menuContainer.style.display = 'block';
    } else if (screen === 'reportView') {
      show($('reportViewPage'));
      if ($('pageTag')) $('pageTag').textContent = 'Report';
      if (menuContainer) menuContainer.style.display = 'block';
    } else {
      show($('homePage'));
      if ($('pageTag')) $('pageTag').textContent = 'Home';
      if (menuContainer) menuContainer.style.display = 'none';
    }
  }

  function setHash(screen){ location.hash = `#/${screen}`; }
  function currentHash(){ return (location.hash || '').replace(/^#\//,''); }

  window.addEventListener('hashchange', () => {
    const page = currentHash();
    if (!getToken()) {
      if (page === 'signup') { goTo('signup'); }
      else if (page === 'login') { goTo('login'); }
      else { goTo('home'); }
      return;
    }
    if (page === 'library') { loadLibrary(); }
    else if (page === 'profile') { goTo('profile'); }
    else if (page === 'analysis') { goTo('analysis'); }
    else if (page.startsWith('reportView')) { goTo('reportView'); }
    else { setHash('analysis'); }
  });

  /* Menu */
  const menuIcon = $('menuIcon');
  const menuPanel = $('menu');
  if (menuIcon) {
    menuIcon.addEventListener('click', ()=> menuPanel.classList.toggle('active'));
  }
  window.addEventListener('click',(e)=>{
    if (!menuPanel.contains(e.target) && !menuIcon.contains(e.target)){
      menuPanel.classList.remove('active');
    }
  });

  /* Auth */
  function setLoginMessage(t, ok=true){
    const msg = $('loginMsg');
    if (!msg) return;
    msg.textContent = t;
    msg.className = ok ? 'ok' : 'err';
  }

  function setSignupMessage(t, ok=true){
    const msg = $('signupMsg');
    if (!msg) return;
    msg.textContent = t;
    msg.className = ok ? 'ok' : 'err';
  }

  async function doSignup(){
    const name = $('su_name').value.trim();
    const email = $('su_email').value.trim();
    const password = $('su_password').value.trim();
    const dob = $('su_dob').value.trim();
    
    if (!name || !email || !password || !dob){
      return setSignupMessage('Please fill all fields', false);
    }
    
    // Calculate age from date of birth
    const birthDate = new Date(dob);
    const today = new Date();
    const age = Math.floor((today - birthDate) / (365.25 * 24 * 60 * 60 * 1000));
    
    const payload = { name, email, password, age, dob };
    setSignupMessage('Creating account‚Ä¶');
    const out = await api('/api/signup', { method:'POST', body: JSON.stringify(payload) });
    if (out.ok && out.token){
      setToken(out.token);
      setSignupMessage('Welcome! ‚úÖ', true);
      proceedToAnalysis();
    } else {
      setSignupMessage(out.error || 'Signup failed', false);
    }
  }

  async function doLogin(){
    const email = $('li_email').value.trim();
    const password = $('li_password').value.trim();
    if (!email || !password) return setLoginMessage('Enter email & password', false);
    setLoginMessage('Logging in‚Ä¶');
    const out = await api('/api/login', { method:'POST', body: JSON.stringify({email, password}) });
    if (out.ok && out.token){
      setToken(out.token);
      setLoginMessage('Logged in ‚úÖ', true);
      proceedToAnalysis();
    } else {
      setLoginMessage(out.error || 'Login failed', false);
    }
  }

  function proceedToAnalysis(){
    setHash('analysis');
    goTo('analysis');
    $('splash').style.display='none';
  }

  async function doLogout(){
    try {
      // Call logout endpoint to invalidate token on server
      await api('/api/logout', { method: 'POST' });
    } catch (err) {
      console.error('Logout error:', err);
    }
    clearToken();
    try { menuPanel.classList.remove('active'); } catch {}
    document.querySelector('.menu-container').style.display='none';
    setHash('account');
    goTo('account');
  }

  /* Menu links */
  $('profileLink')?.addEventListener('click',(e)=>{e.preventDefault();menuPanel.classList.remove('active');setHash('profile')});
  $('newAnalysis')?.addEventListener('click',(e)=>{e.preventDefault();menuPanel.classList.remove('active');setHash('analysis');hide($('results'))});
  $('library')?.addEventListener('click',(e)=>{e.preventDefault();menuPanel.classList.remove('active');setHash('library')});
  $('logout')?.addEventListener('click',e=>{e.preventDefault();doLogout()});

  /* Analyze */
  function updateFormFields(){
    const videoType = document.querySelector('input[name="videoType"]:checked').value;
    const gameFields = $('gameFields');
    const trainingFields = $('trainingFields');
    
    if (videoType === 'game'){
      show(gameFields);
      hide(trainingFields);
    } else {
      hide(gameFields);
      show(trainingFields);
    }
  }

  async function doAnalyze(){
    hide($('results'));
    const uploadMethod = document.querySelector('input[name="uploadMethod"]:checked').value;
    let videoUrl = '';
    let videoDuration = 0;
    const videoType = document.querySelector('input[name="videoType"]:checked').value;

    // Check upload method
    if (uploadMethod === 'file') {
      // File upload - check if Cloudinary upload completed
      if (cloudinaryVideoUrl) {
        videoUrl = cloudinaryVideoUrl;
        videoDuration = cloudinaryVideoDuration || 30;
      } else if (!uploadedFile) {
        $('analyzeStatus').textContent = 'Please select a video file first';
        $('analyzeStatus').className = 'err';
        return;
      } else {
        $('analyzeStatus').textContent = 'Please wait for video to finish uploading';
        $('analyzeStatus').className = 'err';
        return;
      }
    } else {
      // URL upload
      videoUrl = $('videoUrl').value.trim();
      videoDuration = Number($('videoDuration').value || 60);
      if (!videoUrl) {
        $('analyzeStatus').textContent = 'Please enter a video URL';
        $('analyzeStatus').className = 'err';
        return;
      }
    }

    let candInfo = {};
    if (videoType === 'game'){
      const jerseyNum = Number($('cand_jersey').value || 0);
      const jerseyColor = $('cand_jersey_color').value;
      if (!jerseyNum){
        $('analyzeStatus').textContent = 'Jersey number required for game footage';
        $('analyzeStatus').className = 'err';
        return;
      }
      if (!jerseyColor){
        $('analyzeStatus').textContent = 'Jersey color required for game footage';
        $('analyzeStatus').className = 'err';
        return;
      }
      candInfo = {
        name: $('cand_name').value.trim(),
        position: $('cand_position').value.trim(),
        age: Number($('cand_age').value || 0),
        jersey: jerseyNum,
        jerseyColor: jerseyColor
      };
    } else {
      candInfo = {
        name: $('train_name').value.trim(),
        position: $('train_position').value.trim(),
        focus: $('train_focus').value.trim()
      };
    }

    $('analyzeStatus').textContent = 'Analyzing‚Ä¶';
    $('analyzeStatus').className = 'muted';

    try{
      // Prepare payload with video URL
      const payload = {
        videoUrl,
        duration: videoDuration,
        videoType,
        candidateInfo: candInfo
      };
      
      const out = await api('/api/analyze', { method:'POST', body: JSON.stringify(payload) });

      if (!out.ok){
        $('analyzeStatus').textContent = out.error || 'Analysis failed';
        $('analyzeStatus').className = 'err';
        return;
      }

      $('summary').textContent = out.summary || 'Analysis complete';

      if (videoType === 'training') {
        // Show training results
        hide($('gameResults'));
        show($('trainingResults'));

        $('skillFocus').textContent = out.skillFocus || 'Skill assessment';
        $('skillRecognition').textContent = (out.secondarySkills || []).join(', ') || 'Training session analysis';
        $('skillGrade').textContent = out.currentLevel?.grade || '?';
        $('skillLevelDesc').textContent = out.currentLevel?.description || 'Keep practicing';

        // Technical Analysis
        const tech = out.technicalAnalysis || {};
        $('techFootwork').textContent = tech.footwork || '‚Äî';
        $('techBodyPosition').textContent = tech.bodyPosition || '‚Äî';
        $('techFollowThrough').textContent = tech.followThrough || '‚Äî';
        $('techConsistency').textContent = tech.consistency || '‚Äî';
        $('techProgression').textContent = tech.sessionProgression || '‚Äî';

        // Improvement Tips (with priority structure)
        if (out.improvementTips && out.improvementTips.length){
          $('improvementTips').innerHTML = out.improvementTips.map(t => `
            <li><strong>Priority ${t.priority}:</strong> ${t.tip}<br>
            <span class="muted">Why: ${t.why}</span><br>
            <span class="muted">How: ${t.how}</span></li>
          `).join('');
        } else {
          $('improvementTips').innerHTML = '<li>No tips available</li>';
        }

        // Common Mistakes
        if (out.commonMistakesForPosition && out.commonMistakesForPosition.length){
          $('commonMistakes').innerHTML = out.commonMistakesForPosition.map(m => `
            <li><strong>${m.mistake}</strong> (${m.observed ? 'Observed' : 'Not observed'})<br>
            <span class="muted">Correction: ${m.correction}</span></li>
          `).join('');
        } else {
          $('commonMistakes').innerHTML = '<li>No mistakes data</li>';
        }

        if (out.practiceProgression && out.practiceProgression.length){
          $('progressionList').innerHTML = out.practiceProgression.map(p=>`
            <div style="background:linear-gradient(135deg,rgba(0,255,149,0.08),rgba(25,211,255,0.08));border:1.5px solid var(--line);border-left:4px solid var(--accent);padding:16px;border-radius:12px">
              <div style="color:var(--accent);font-weight:700;margin-bottom:8px">${p.level}</div>
              <p style="margin:0;color:var(--text);font-size:14px;line-height:1.6">${p.drill}</p>
            </div>
          `).join('');
        }

        if (out.youtubeRecommendations && out.youtubeRecommendations.length){
          $('youtubeList').innerHTML = out.youtubeRecommendations.map(y=>`
            <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(y.title)}" target="_blank" style="text-decoration:none">
              <div style="background:linear-gradient(135deg,rgba(25,211,255,0.08),rgba(0,255,149,0.04));border:1.5px solid var(--line);padding:14px;border-radius:12px;transition:all 0.2s;cursor:pointer">
                <div style="color:var(--accent2);font-weight:700;font-size:15px;margin-bottom:4px">‚ñ∂ ${y.title}</div>
                <p class="muted" style="margin:4px 0;font-size:13px">Channel: ${y.coach}</p>
                <p style="margin:8px 0;color:var(--text);font-size:13px;line-height:1.5">${y.why}</p>
              </div>
            </a>
          `).join('');
        }
      } else {
        // Show game results
        hide($('trainingResults'));
        show($('gameResults'));

        $('playerGrade').textContent = out.playerGrade || '?';
        $('gameSmry').textContent = out.summary || 'Game performance analysis';

        // Player Stats
        if (out.playerStats) {
          $('statPasses').textContent = out.playerStats.passes || 0;
          $('statShots').textContent = out.playerStats.shots || 0;
          $('statTackles').textContent = out.playerStats.tackles || 0;
          $('statInterceptions').textContent = out.playerStats.interceptions || 0;
        }

        // Pass Metrics
        if (out.passMetrics) {
          $('passAttempts').textContent = out.passMetrics.attempts || 0;
          $('passCompleted').textContent = out.passMetrics.completed || 0;
          $('passAccuracy').textContent = (out.passMetrics.accuracy || 0) + '%';
          $('keyPasses').textContent = out.passMetrics.keyPasses || 0;
        }

        // Shot Metrics
        if (out.shotMetrics) {
          $('shotAttempts').textContent = out.shotMetrics.attempts || 0;
          $('shotOnTarget').textContent = out.shotMetrics.onTarget || 0;
          $('shotGoals').textContent = out.shotMetrics.goals || 0;
          $('shotAccuracy').textContent = (out.shotMetrics.accuracy || 0) + '%';
        }

        // Defensive Metrics
        if (out.defensiveMetrics) {
          $('defTackles').textContent = out.defensiveMetrics.tackles || 0;
          $('defInterceptions').textContent = out.defensiveMetrics.interceptions || 0;
          $('defClearances').textContent = out.defensiveMetrics.clearances || 0;
          $('defSuccessRate').textContent = (out.defensiveMetrics.successRate || 0) + '%';
        }

        // Ball Control
        if (out.ballControl) {
          $('ballTouches').textContent = out.ballControl.touches || 0;
          $('ballPossession').textContent = out.ballControl.possessionTime || '0s';
          $('ballSuccess').textContent = (out.ballControl.successPercentage || 0) + '%';
        }

        // Strengths
        if (out.strengths && out.strengths.length){
          $('strengths').innerHTML = out.strengths.map(x=>`<li style="margin-bottom:12px;color:var(--text);font-size:15px">${x}</li>`).join('');
        }

        // Areas to Improve
        if (out.areasToImprove && out.areasToImprove.length){
          $('areasToImprove').innerHTML = out.areasToImprove.map(x=>`<li style="margin-bottom:12px;color:var(--text);font-size:15px">${x}</li>`).join('');
        }
      }

      show($('results'));
      $('analyzeStatus').textContent = 'Done ‚úÖ';
      $('analyzeStatus').className = 'ok';
      $('results').scrollIntoView({behavior:'smooth',block:'start'});
    }catch(e){
      console.error(e);
      $('analyzeStatus').textContent = 'Error: ' + e.message;
      $('analyzeStatus').className = 'err';
    }
  }

  /* Library */
  async function loadLibrary(){
    try{
      const res = await api('/api/analyses');
      if (!res.ok) throw new Error(res.error || 'Failed');
      const items = res.items || [];
      goTo('library');
      $('libraryList').innerHTML = items.length
        ? items.map(i => `
            <div class="card">
              <strong>${i.candidateName || 'Candidate'}</strong><br>
              <span class="muted">${new Date(i.createdAt).toLocaleString()}</span><br>
              <span>${i.summary || 'Analysis saved'}</span><br>
              <button style="margin-top:8px;padding:6px 12px;font-size:13px" onclick="viewAnalysis('${i.id}')">View</button>
              <button style="margin-top:8px;padding:6px 12px;font-size:13px;background:#ff6b6b;box-shadow:0 2px 8px rgba(255,107,107,0.2)" onclick="deleteAnalysis('${i.id}')">Delete</button>
            </div>
          `).join('')
        : '<p class="muted">No analyses saved yet</p>';
    }catch(e){
      alert(e.message);
    }
  }

  async function viewAnalysis(id){
    try {
      const res = await api(`/api/analyses/${id}`);
      if (!res.ok) throw new Error(res.error || 'Failed to load analysis');
      
      const item = res;
      
      console.log('[Ball Knowledge] Loading analysis:', item.videoType, item.candidateName);
      
      // Navigate to report view page
      setHash('reportView');
      goTo('reportView');
      
      // Wait a moment for DOM to be ready
      await new Promise(resolve => setTimeout(resolve, 100));
      
      // Display YouTube video if available
      const videoUrl = item.videoUrl || '';
      if (videoUrl && videoUrl.includes('youtube.com')) {
        const videoId = videoUrl.split('v=')[1]?.split('&')[0];
        if (videoId) {
          $('viewYoutubePlayer').innerHTML = `<iframe width="100%" height="450" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="border-radius:12px"></iframe>`;
          $('viewYoutubeSection').classList.remove('hide');
        } else {
          $('viewYoutubePlayer').innerHTML = '<p class="muted">Invalid YouTube URL</p>';
        }
      } else {
        $('viewYoutubeSection').classList.add('hide');
      }
      
      // Set video type to show correct sections
      if (item.videoType === 'training') {
        $('viewTrainingResults').classList.remove('hide');
        $('viewGameResults').classList.add('hide');
        
        // Use flattened fields from API response
        $('viewSkillFocus').textContent = item.skillFocus || '‚Äî';
        $('viewSkillRecognition').textContent = item.secondarySkills?.join(', ') || '‚Äî';
        $('viewSkillGrade').textContent = item.currentLevel?.grade || '‚Äî';
        $('viewSkillLevelDesc').textContent = item.currentLevel?.description || '‚Äî';
        
        // Technical Analysis
        const tech = item.technicalAnalysis || {};
        $('viewTechFootwork').textContent = tech.footwork || '‚Äî';
        $('viewTechBodyPosition').textContent = tech.bodyPosition || '‚Äî';
        $('viewTechFollowThrough').textContent = tech.followThrough || '‚Äî';
        $('viewTechConsistency').textContent = tech.consistency || '‚Äî';
        $('viewTechProgression').textContent = tech.sessionProgression || '‚Äî';
        
        // Improvement Tips
        const tips = item.improvementTips || [];
        $('viewImprovementTips').innerHTML = tips.length 
          ? tips.map(t => `<li><strong>Priority ${t.priority}:</strong> ${t.tip}<br><span class="muted">Why: ${t.why}</span><br><span class="muted">How: ${t.how}</span></li>`).join('')
          : '<li>No tips available</li>';
        
        // Common Mistakes
        const mistakes = item.commonMistakesForPosition || [];
        $('viewCommonMistakes').innerHTML = mistakes.length
          ? mistakes.map(m => `<li><strong>${m.mistake}</strong> (${m.observed ? 'Observed' : 'Not observed'})<br><span class="muted">Correction: ${m.correction}</span></li>`).join('')
          : '<li>No mistakes data</li>';
        
        // Practice Progression
        const progression = item.practiceProgression || [];
        $('viewProgressionList').innerHTML = progression.length
          ? progression.map(p => `
            <div style="background:linear-gradient(135deg,rgba(0,255,149,0.08),rgba(25,211,255,0.08));border:1.5px solid var(--line);border-left:4px solid var(--accent);padding:16px;border-radius:12px">
              <div style="color:var(--accent);font-weight:700;margin-bottom:8px">${p.level}</div>
              <p style="margin:0;color:var(--text);font-size:14px;line-height:1.6">${p.drill}</p>
            </div>
          `).join('')
          : '<p>No progression data</p>';
        
        // YouTube Recommendations
        const youtube = item.youtubeRecommendations || [];
        $('viewYoutubeList').innerHTML = youtube.length
          ? youtube.map(y => `
            <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(y.title)}" target="_blank" style="text-decoration:none">
              <div style="background:linear-gradient(135deg,rgba(25,211,255,0.08),rgba(0,255,149,0.04));border:1.5px solid var(--line);padding:14px;border-radius:12px;transition:all 0.2s;cursor:pointer">
                <div style="color:var(--accent2);font-weight:700;font-size:15px;margin-bottom:4px">‚ñ∂ ${y.title}</div>
                <p class="muted" style="margin:4px 0;font-size:13px">Channel: ${y.coach}</p>
                <p style="margin:8px 0;color:var(--text);font-size:13px;line-height:1.5">${y.why}</p>
              </div>
            </a>
          `).join('')
          : '<p>No video recommendations</p>';
        
        // Session Summary
        $('viewSummary').textContent = item.sessionSummary || item.summary || '‚Äî';
        
      } else {
        // Game analysis
        $('viewGameResults').classList.remove('hide');
        $('viewTrainingResults').classList.add('hide');
        
        // Use flattened fields from API response
        $('viewPlayerGrade').textContent = item.playerGrade || '‚Äî';
        $('viewGameSmry').textContent = item.summary || '‚Äî';
        $('viewSummary').textContent = item.summary || '‚Äî';
        
        // Stats
        const stats = item.playerStats || {};
        $('viewStatPasses').textContent = stats.passes || 0;
        $('viewStatShots').textContent = stats.shots || 0;
        $('viewStatTackles').textContent = stats.tackles || 0;
        $('viewStatInterceptions').textContent = stats.interceptions || 0;
        
        // Pass metrics
        const passMetrics = item.passMetrics || {};
        $('viewPassAttempts').textContent = passMetrics.attempts || 0;
        $('viewPassCompleted').textContent = passMetrics.completed || 0;
        $('viewPassAccuracy').textContent = (passMetrics.accuracy || 0) + '%';
        $('viewKeyPasses').textContent = passMetrics.keyPasses || 0;
        
        // Shot metrics
        const shotMetrics = item.shotMetrics || {};
        $('viewShotAttempts').textContent = shotMetrics.attempts || 0;
        $('viewShotOnTarget').textContent = shotMetrics.onTarget || 0;
        $('viewShotGoals').textContent = shotMetrics.goals || 0;
        $('viewShotAccuracy').textContent = (shotMetrics.accuracy || 0) + '%';
        
        // Defensive metrics
        const defMetrics = item.defensiveMetrics || {};
        $('viewDefTackles').textContent = defMetrics.tackles || 0;
        $('viewDefInterceptions').textContent = defMetrics.interceptions || 0;
        $('viewDefClearances').textContent = defMetrics.clearances || 0;
        $('viewDefSuccessRate').textContent = (defMetrics.successRate || 0) + '%';
      }
      
      // Highlights
      const highlights = item.highlights || [];
      if (highlights.length) {
        // Display highlights if there's a highlights section
        console.log('Highlights:', highlights);
      }
      
    } catch(e) {
      alert('Error loading analysis: ' + e.message);
    }
  }

  async function deleteAnalysis(id){
    if (!confirm('Delete?')) return;
    const res = await api(`/api/analyses/${id}`, { method:'DELETE' });
    if (res.ok) loadLibrary();
  }
  /* Profile */
  let currentProfileData = {};

  async function loadProfile(){
    try {
      const res = await api('/api/profile');
      if (!res.ok) throw new Error(res.error || 'Could not load profile');
      
      currentProfileData = res;
      const user = res.user || {};
      const profile = res.profile || {};
      
      // Fill in view mode
      $('profileName').textContent = user.name || '‚Äî';
      $('profileEmail').textContent = user.email || '‚Äî';
      $('profileAge').textContent = user.age ? `${user.age} years old` : '‚Äî';
      
      if (user.dob) {
        let dobDate;
        if (user.dob.includes('T')) {
          dobDate = new Date(user.dob);
        } else if (user.dob.includes('-')) {
          const [year, month, day] = user.dob.split('-');
          dobDate = new Date(year, parseInt(month) - 1, day);
        } else {
          dobDate = new Date(user.dob);
        }
        
        if (!isNaN(dobDate.getTime())) {
          $('profileDOB').textContent = dobDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        } else {
          $('profileDOB').textContent = user.dob || '‚Äî';
        }
      } else {
        $('profileDOB').textContent = '‚Äî';
      }
      
      $('profilePosition').textContent = profile.position || '‚Äî';
      $('profileFoot').textContent = profile.foot ? (profile.foot === 'R' ? 'Right' : profile.foot === 'L' ? 'Left' : 'Both') : '‚Äî';
      
      if (profile.height) {
        const feet = Math.floor(profile.height / 12);
        const inches = profile.height % 12;
        $('profileHeight').textContent = `${feet}'${inches}"`;
      } else {
        $('profileHeight').textContent = '‚Äî';
      }
      
      $('profileWeight').textContent = profile.weight ? `${profile.weight} lbs` : '‚Äî';
      
      // Fill in edit mode
      $('editName').value = user.name || '';
      $('editAge').value = user.age || '';
      $('editDOB').value = user.dob || '';
      $('editPosition').value = profile.position || '';
      $('editFoot').value = profile.foot || '';
      $('editHeightFeet').value = profile.height ? Math.floor(profile.height / 12) : '';
      $('editHeightInches').value = profile.height ? (profile.height % 12) : '';
      $('editWeight').value = profile.weight || '';
      
      // Show view mode, hide edit mode
      hide($('profileEditMode'));
      show($('profileViewMode'));
      
    } catch (e) {
      console.error('Profile load error:', e);
      alert('Could not load profile');
    }
  }

  function showEditMode(){
    hide($('profileViewMode'));
    show($('profileEditMode'));
  }

  function hideEditMode(){
    hide($('profileEditMode'));
    show($('profileViewMode'));
  }

  /* Upload Handling */
  let uploadedFile = null;
  let cloudinaryVideoUrl = null;
  let cloudinaryVideoDuration = null;

  // File upload handling
  const dropZone = $('dropZone');
  const libraryInput = $('videoLibraryInput');
  const cameraInput = $('videoCameraInput');
  const fileInfo = $('fileInfo');

  dropZone.addEventListener('click', () => libraryInput.click());

  // Auto-upload to Cloudinary when file is selected
  async function uploadToCloudinary(file) {
    const sizeMB = (file.size / 1024 / 1024).toFixed(1);
    fileInfo.innerHTML = `‚è≥ Uploading ${file.name} (${sizeMB} MB)...<br><span class="muted">Please wait, this may take a moment</span>`;
    $('uploadMsg').textContent = '';

    const formData = new FormData();
    formData.append('file', file);
    formData.append('upload_preset', 'BallKnowledge');
    formData.append('cloud_name', 'dblconpx8');

    try {
      const response = await fetch('https://api.cloudinary.com/v1_1/dblconpx8/video/upload', {
        method: 'POST',
        body: formData
      });

      if (!response.ok) throw new Error('Upload failed');

      const data = await response.json();
      cloudinaryVideoUrl = data.secure_url;
      cloudinaryVideoDuration = data.duration || 30;
      
      fileInfo.innerHTML = `‚úÖ <strong>${file.name}</strong> uploaded!<br><span style="color:var(--accent)">Size: ${sizeMB}MB | Duration: ${cloudinaryVideoDuration.toFixed(1)}s</span>`;
      $('uploadMsg').textContent = '';
    } catch (error) {
      fileInfo.innerHTML = `‚ùå Upload failed. Please try again.`;
      $('uploadMsg').textContent = error.message;
      cloudinaryVideoUrl = null;
    }
  }

  libraryInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      uploadedFile = file;
      uploadToCloudinary(file);
    }
  });

  cameraInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      uploadedFile = file;
      uploadToCloudinary(file);
    }
  });

  // Drag and drop
  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.style.borderColor = 'var(--accent2)';
    dropZone.style.background = 'rgba(0,255,149,0.05)';
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.style.borderColor = 'var(--accent)';
    dropZone.style.background = 'transparent';
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.style.borderColor = 'var(--accent)';
    dropZone.style.background = 'transparent';
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('video/')) {
      uploadedFile = file;
      uploadToCloudinary(file);
    } else {
      alert('Please drop a video file');
    }
  });

  // Upload method toggle
  document.querySelectorAll('input[name="uploadMethod"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      if (e.target.value === 'file') {
        show($('fileUploadSection'));
        hide($('urlUploadSection'));
      } else {
        hide($('fileUploadSection'));
        show($('urlUploadSection'));
      }
    });
  });

  // Trigger initial display
  const checkedMethod = document.querySelector('input[name="uploadMethod"]:checked');
  if (checkedMethod) {
    checkedMethod.dispatchEvent(new Event('change'));
  }

  async function saveProfile(){
    const heightFeet = Number($('editHeightFeet').value || 0);
    const heightInches = Number($('editHeightInches').value || 0);
    const totalHeight = (heightFeet * 12) + heightInches;

    const payload = {
      name: $('editName').value.trim(),
      age: Number($('editAge').value || 0),
      dob: $('editDOB').value,
      position: $('editPosition').value,
      foot: $('editFoot').value,
      height: totalHeight || 0,
      weight: Number($('editWeight').value || 0)
    };

    try {
      const res = await api('/api/profile', {
        method: 'POST',
        body: JSON.stringify(payload)
      });

      if (!res.ok) throw new Error(res.error || 'Update failed');
      
      alert('Profile updated successfully!');
      await loadProfile();
    } catch (e) {
      alert('Error updating profile: ' + (e.message || 'Unknown error'));
    }
  }
  
  // ========= THEME TOGGLE =========
  function toggleTheme(){
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme') || 'dark';
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    html.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    const icon = document.getElementById('themeIcon');
    const text = document.getElementById('themeText');
    
    if(newTheme === 'light'){
      icon.textContent = '‚òÄÔ∏è';
      text.textContent = 'Light';
    } else {
      icon.textContent = 'üåô';
      text.textContent = 'Dark';
    }
  }
  
  // Load saved theme on startup
  (function(){
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);
    const icon = document.getElementById('themeIcon');
    const text = document.getElementById('themeText');
    if(icon && text && savedTheme === 'light'){
      icon.textContent = '‚òÄÔ∏è';
      text.textContent = 'Light';
    }
  })();
  
  /* Wire up */
  $('signupBtn')?.addEventListener('click', doSignup);
  $('loginBtn')?.addEventListener('click', doLogin);
  $('analyzeBtn')?.addEventListener('click', doAnalyze);
  $('newAnalysisBtn')?.addEventListener('click', () => { hide($('results')); $('videoUrl').value=''; $('videoDuration').value=''; });
  $('saveAnalysisBtn')?.addEventListener('click', async () => {
    const res = await api('/api/analyses', { method:'POST', body: JSON.stringify({ summary: $('summary').textContent }) });
    if (res.ok) alert('Saved!');
    else alert(res.error || 'Save failed');
  });

  // Profile buttons
  $('editProfileBtn')?.addEventListener('click', showEditMode);
  $('cancelEditBtn')?.addEventListener('click', hideEditMode);
  $('saveProfileBtn')?.addEventListener('click', saveProfile);
  $('viewLibraryBtn')?.addEventListener('click', (e) => {
    e.preventDefault();
    setHash('library');
  });

  /* Bootstrap */
  document.addEventListener('DOMContentLoaded', () => {
    try{
      if (getToken()) {
        const page = currentHash();
        if (page === 'library') { loadLibrary(); }
        else if (page === 'profile') { goTo('profile'); }
        else { setHash('analysis'); goTo('analysis'); }
      } else {
        const page = currentHash();
        if (page === 'login') { goTo('login'); }
        else if (page === 'signup') { goTo('signup'); }
        else { goTo('home'); }
      }
    } finally {
      $('splash').style.display='none';
    }
  });
  </script>
</body>
</html>
